<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" template="/layout/userpage.xhtml">
	<ui:define name="menu">
		<ui:include name="menu" src="/layout/dymenu.xhtml" />
	</ui:define>

	<ui:define name="userdesk">
		<div align="center">

			<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
				closable="false" resizable="false" showHeader="false">
				<h1 id="note">正在处理，请稍候......</h1>
				<img src="#{request.contextPath}/images/ajaxloadingbar.gif" />
			</p:dialog>

			<h:form id="formone">
				<p:dialog visible="#{not empty facesContext.messageList}"
					header="#{facesContext.messageList[0].severity eq 'ERROR 2'?'错误':' '}"
					modal="true">
					<p:repeat value="#{facesContext.messageList}" var="message">
						<h:panelGrid columns="2" style="width:100%"
							columnClasses="logo,detail">
							<p:graphicImage rendered="#{message.severity eq 'INFO 0'}"
								url="/images/info.png" />
							<p:graphicImage rendered="#{message.severity eq 'WARN 1'}"
								url="/images/warn.png" />
							<p:graphicImage rendered="#{message.severity eq 'ERROR 2'}"
								url="/images/error.png" />
							<h:outputText value="#{message.detail}" style="font-weight: bold" />
						</h:panelGrid>
					</p:repeat>
				</p:dialog>
				<p:messages id="ajaxmsg" showDetail="true" autoUpdate="true"
					closable="true" />

				<div align="left">
					<p:fieldset legend="筛选" id="filterPanel" collapsed="false"
						widgetVar="filter" toggleable="true" toggleSpeed="500">
						<table>
							<tr>
								<td>投诉编号</td>
								<td>用户名称</td>
								<td>状态</td>
							</tr>
							<tr>
								<td><p:inputText id="filterEventnoe"
										value="#{eventList.filterEventno}" /></td>
								<td><p:inputText id="filterCustName"
										value="#{eventList.filterCustName}" /></td>
								<td><p:selectOneMenu id="filterState"
										value="#{eventList.filterState}">
										<f:selectItem itemValue="" itemLabel="" />
										<f:selectItem itemValue="已受理" itemLabel="已受理" />
										<f:selectItem itemValue="已转办" itemLabel="已转办" />
										<f:selectItem itemValue="处理中" itemLabel="处理中" />
										<f:selectItem itemValue="处理完毕" itemLabel="处理完毕" />
									</p:selectOneMenu></td>
							</tr>
							<tr>
								<td colspan="2">申请日期</td>
							</tr>
							<tr>
								<td><p:calendar id="filterAppDateBegin"
										value="#{eventList.filterAppDateBegin}" pattern="yyyy/MM/dd"
										navigator="true" readonlyInput="true" yearRange="c:c+5">
									</p:calendar></td>
								<td><p:calendar id="filterAppDateEnd"
										value="#{eventList.filterAppDateEnd}" pattern="yyyy/MM/dd"
										navigator="true" readonlyInput="true" yearRange="c:c+5">
									</p:calendar></td>
							</tr>
						</table>
						<br />
						<div align="center">
							<p:commandButton value="清空" update="oneTable filterPanel"
								actionListener="#{eventList.resetFilter}" immediate="true"
								resetValues="true" />
							<p:commandButton value="查询" update="oneTable filterPanel"
								actionListener="#{eventList.doFilter}" />
						</div>
					</p:fieldset>
				</div>

				<div align="center">
					<p:dataTable id="oneTable" var="creg" value="#{eventList.model}"
						paginator="true" paginatorPosition="top" rows="10"
						paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
						emptyMessage="无数据" editable="false" selectionMode="single"
						selection="#{eventList.selectedCreg}" rowKey="#{creg.id}"
						rowsPerPageTemplate="5,10,15" lazy="true">
						<f:facet name="header">
							<h:outputText value="事件登记" style="font-size:32px;" />
						</f:facet>
						<p:column sortBy="#{creg.eventno}" headerText="编号"
							style="width:100px;">
							<h:commandLink value="#{creg.eventno}"
								action="#{eventBean.openpage('creg')}" target="_blank"
								style="color:#{creg.appColor} !important">
								<f:param name="eventid" value="#{creg.id}" />
							</h:commandLink>
						</p:column>
						<p:column sortBy="#{creg.custname}" headerText="用户名称"
							style="width:80px;">
							<h:commandLink value="#{creg.custname}"
								action="#{eventBean.openpage('creg')}" target="_blank"
								style="color:#{creg.appColor} !important">
								<f:param name="eventid" value="#{creg.id}" />
							</h:commandLink>
						</p:column>
						<p:column sortBy="#{creg.capptime}" headerText="日期"
							style="width:150px;">
							<h:outputText value="#{creg.capptime} "
								style="color:#{creg.appColor}">
								<f:convertDateTime pattern="yyyy/MM/dd HH:mm:ss" locale="en_SG"
									timeZone="GMT+8" />
							</h:outputText>
						</p:column>
						<p:column sortBy="#{creg.capprove}" headerText="状态"
							style="width:60px;">
							<h:outputText value="#{creg.capprove}"
								style="color:#{creg.appColor}" />
						</p:column>
						<p:column rendered="#{eventList.userRole eq '微信投诉管理员'}"
							sortBy="#{creg.passtoarea}" headerText="受理单位"
							style="width:115px;">
							<h:outputText value="#{creg.passtoarea}"
								style="color:#{creg.appColor}" />
						</p:column>

						<p:column headerText="操作" style="text-align:center;width:100px;">
							<p:commandButton rendered="#{eventList.userRole eq '微信投诉管理员'}"
								value="预览" onclick="setText('note','正在生成和转换文档，请稍候......')"
								style="width:70px;margin:0;float:left;" update="formone"
								action="#{eventList.preview}">
								<p:ajaxStatus onstart="PF('statusDialog').show()"
									onsuccess="PF('statusDialog').hide()" />
								<f:setPropertyActionListener value="#{creg}"
									target="#{eventList.selectedCreg}" />
							</p:commandButton>
							<p:link styleClass="s_icon"
								rendered="#{creg.cno ne null and creg.cno ne ''}"
								target="_blank" href="/userspace/#{creg.eventno}/网络投诉登记表.doc"
								value="."></p:link>
						</p:column>

						<f:facet name="footer">
							<p:link styleClass="button3" target="_blank" style="width:110px;"
								href="/eventhand/creg.xhtml?cn=1" value="新的登记" />
						</f:facet>
					</p:dataTable>
				</div>

			</h:form>
		</div>
	</ui:define>
</ui:composition>

